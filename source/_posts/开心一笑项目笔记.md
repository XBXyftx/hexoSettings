---
title: å¼€å¿ƒä¸€ç¬‘é¡¹ç›®ç¬”è®°
date: 2025-01-30 23:32:04
tags:
  - é¸¿è’™
  - æŠ€æœ¯å‘
  - é¡¹ç›®
cover: /img/ArticleTopImgs/JokeTopImg.png
description: ä¸‹æ‹‰åˆ·æ–°ä¸Žè§¦åº•åŠ è½½é€»è¾‘çš„ç»ƒä¹ é¡¹ç›®
typewriter: ðŸ˜„ æ‰“é€ è¶£å‘³åè¶³çš„ç¬‘è¯åº”ç”¨ï¼æœ¬æ–‡è¯¦ç»†è®°å½•äº†"å¼€å¿ƒä¸€ç¬‘"é¸¿è’™é¡¹ç›®çš„å®Œæ•´å¼€å‘è¿‡ç¨‹ã€‚é¡¹ç›®é‡ç‚¹ç»ƒä¹ äº†ä¸‹æ‹‰åˆ·æ–°å’Œè§¦åº•åŠ è½½çš„æ ¸å¿ƒäº¤äº’é€»è¾‘ï¼Œé€šè¿‡æŽ¥å£è°ƒç”¨å®žçŽ°ç¬‘è¯å†…å®¹çš„åŠ¨æ€èŽ·å–ä¸Žå±•ç¤ºã€‚æ¶µç›–äº†UIæ¡†æž¶æ­å»ºã€ç½‘ç»œè¯·æ±‚å°è£…ã€æ•°æ®æ¸²æŸ“ã€ç”¨æˆ·äº¤äº’å¤„ç†ç­‰å…³é”®æŠ€æœ¯ç‚¹ã€‚é€šè¿‡å®žé™…ä»£ç ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨é¸¿è’™åº”ç”¨ä¸­å®žçŽ°æµç•…çš„åˆ—è¡¨åˆ·æ–°ä½“éªŒï¼Œæ˜¯å­¦ä¹ é¸¿è’™åº”ç”¨å¼€å‘å’Œç”¨æˆ·ä½“éªŒä¼˜åŒ–çš„å®žç”¨é¡¹ç›®æ¡ˆä¾‹ã€‚
post_copyright:
copyright_author: XBXyftx
copyright_author_href: https://github.com/XBXyftx
copyright_url: https://xbxyftx.top
copyright_info: æ­¤æ–‡ç« ç‰ˆæƒå½’XBXyftxæ‰€æœ‰ï¼Œå¦‚æœ‰è½¬è½½ï¼Œè¯·è¨»æ˜Žæ¥è‡ªåŽŸä½œè€…
---

## é¡¹ç›®æ¦‚è¿°

### UIéª¨æž¶

```TS
/**
 * 1. é»˜è®¤åŠ è½½
 * 2. ä¸‹æ‹‰åˆ·æ–°
 * 3. è§¦åº•åŠ è½½æ›´å¤š
 * 4. ç‚¹å‡»è¿”å›žé¡¶éƒ¨
 * */
@Entry
@Component
struct Day01_07_Jokes {
  @State jokes: string [] = ['ç¬‘è¯ 1']
  jokeNum: number = 5
  @State refreshing: boolean = false
  listScroller: Scroller = new Scroller()

  build() {
    Refresh({ refreshing: $$this.refreshing }) {
      Column() {
        // é¡¶éƒ¨
        this.HeaderBuilder()
        // ç¬‘è¯åˆ—è¡¨
        List({ space: 10, scroller: this.listScroller }) {
          ForEach(this.jokes, (joke: string) => {
            ListItem() {
              Column({ space: 10 }) {
                Text('ç¬‘è¯æ ‡é¢˜')
                  .fontSize(20)
                  .fontWeight(600)
                Row({ space: 15 }) {
                  titleIcon({ icon: $r('app.media.ic_public_time'), info: '2024-1-1' })
                  titleIcon({ icon: $r('app.media.ic_public_read'), info: 'é˜…è¯»(6666)' })
                  titleIcon({ icon: $r('app.media.ic_public_comments'), info: 'è¯„è®º(123)' })
                }

                Text(joke)
                  .fontSize(15)
                  .fontColor(Color.Gray)
              }
              .width('100%')
              .alignItems(HorizontalAlign.Start)
              .padding(20)

            }
            .borderRadius(10)
            .backgroundColor(Color.White)
            .shadow({ radius: 2, color: Color.Gray })
          })

        }
        .padding(10)
        .layoutWeight(1)

      }
      .width('100%')
      .height('100%')
      .backgroundColor('#f6f6f6')
    }
  }

  @Builder
  HeaderBuilder() {
    Row() {
      Image($r('app.media.ic_public_drawer_filled'))
        .width(25);

      Image($r('app.media.ic_public_joke_logo'))
        .width(30)

      Image($r('app.media.ic_public_search'))
        .width(30);
    }
    .width('100%')
    .justifyContent(FlexAlign.SpaceBetween)
    .height(60)
    .padding(10)
    .border({ width: { bottom: 2 }, color: '#f0f0f0' })
    .backgroundColor(Color.White)
  }
}

@Component
struct titleIcon {
  icon: ResourceStr = ''
  info: string = ''

  build() {
    Row() {
      Image(this.icon)
        .width(15)
        .fillColor(Color.Gray)
      Text(this.info)
        .fontSize(14)
        .fontColor(Color.Gray)
    }
  }
}
```

è¯¥UIæ¡†æž¶çš„é¢„è§ˆå›¾å¦‚ä¸‹ï¼š
![éª¨æž¶é¢„è§ˆ](å¼€å¿ƒä¸€ç¬‘é¡¹ç›®ç¬”è®°/3.png)

### é¢„æœŸç›®æ ‡

1. é»˜è®¤èŽ·å–è‹¥å¹²æ¡ç¬‘è¯ï¼Œå¹¶æ¸²æŸ“åˆ°é¡µé¢ä¸Š
2. ä¸‹æ‹‰åˆ·æ–°
3. è§¦åº•åŠ è½½æ›´å¤š
4. ç‚¹å‡»è¿”å›žé¡¶éƒ¨

## å®žçŽ°è¿‡ç¨‹

### é»˜è®¤èŽ·å–è‹¥å¹²æ¡ç¬‘è¯

#### ç¡®è®¤æ•°æ®æ ¼å¼å®šä¹‰æŽ¥å£

æˆ‘ä»¬å¯ä»¥é€šè¿‡æŽ¥å£æ–‡æ¡£æ¥ç¡®è®¤æ•°æ®æ ¼å¼å®šä¹‰æŽ¥å£ï¼Œæˆ–æ˜¯é€šè¿‡èŽ·å–çš„æ•°æ®æ¥è‡ªè¡Œç¡®è®¤æ•°æ®æ ¼å¼å®šä¹‰æŽ¥å£ã€‚ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥ã€‚

##### é€šè¿‡æŽ¥å£æ–‡æ¡£ç¡®è®¤æ•°æ®æ ¼å¼å®šä¹‰æŽ¥å£

æŽ¥å£æ–‡æ¡£ï¼š[å¼€å¿ƒä¸€ç¬‘æŽ¥å£æ–‡æ¡£](https://apifox.com/apidoc/shared-e3812a75-2d81-4388-abf4-af83a2758a9a/api-153085966)

åˆ©ç”¨Apifoxæä¾›çš„æŽ¥å£æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤æ•°æ®æ ¼å¼å¦‚ä¸‹ï¼š

![2](å¼€å¿ƒä¸€ç¬‘é¡¹ç›®ç¬”è®°/2.png)

ç”±æ­¤å®šä¹‰æŽ¥å£

```TS
interface JokeResponse {
  msg: string
  code: number
  data: string[]
}
```

##### é€šè¿‡èŽ·å–çš„æ•°æ®ç¡®è®¤æ•°æ®æ ¼å¼å®šä¹‰æŽ¥å£

æˆ‘ä»¬å¯ä»¥é€šè¿‡èŽ·å–çš„æ•°æ®æ¥ç¡®è®¤æ•°æ®æ ¼å¼å®šä¹‰æŽ¥å£ã€‚
é¦–å…ˆèŽ·å–æ•°æ®ï¼š

```TS
  aboutToAppear(): void {
    this.req.request(`https://api-vue-base.itheima.net/api/joke/list?num=${this.jokeNum}`)
      .then((res)=>{
        AlertDialog.show({
          message: res.result.toString()
        })
      })
  }
```

![1](å¼€å¿ƒä¸€ç¬‘é¡¹ç›®ç¬”è®°/1.png)

ç”±æ­¤å®šä¹‰æŽ¥å£

```TS
interface JokeResponse {
  msg: string
  code: number
  data: string[]
}
```

#### é¡µé¢æ˜¾ç¤ºè‡ªåŠ¨åˆ·æ–°

åœ¨åº”ç”¨å¯åŠ¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è‡ªåŠ¨åˆ·æ–°é¡µé¢ï¼Œä»¥èŽ·å–5æ¡éšæœºç¬‘è¯æ¥è¿›è¡Œå±•ç¤ºã€‚
æˆ‘ä»¬å¯ä»¥åœ¨`aboutToAppear`ç”Ÿå‘½å‘¨æœŸä¸­è¿›è¡Œæ•°æ®èŽ·å–ã€‚

```TS
  aboutToAppear(): void {
    this.req.request(`https://api-vue-base.itheima.net/api/joke/list?num=${this.jokeNum}`)
      .then((res)=>{
        this.jokes = (JSON.parse(res.result.toString()) as JokeResponse).data
      })
  }
```

#### ç¬‘è¯æ ‡é¢˜æˆªå–

ç”±äºŽç¬‘è¯å†…å®¹è¿‡é•¿ï¼Œå¹¶ä¸”æ¯æ¡ç¬‘è¯æœåŠ¡å™¨è¿”å›žçš„éƒ½åªæœ‰ç¬‘è¯çš„å†…å®¹ï¼Œè€Œæ²¡æœ‰ç¬‘è¯çš„æ ‡é¢˜ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯¹ç¬‘è¯å†…å®¹è¿›è¡Œæˆªå–ï¼Œä»¥èŽ·å–ç¬‘è¯çš„æ ‡é¢˜ã€‚
è¿™é‡Œå¯ä»¥åˆ©ç”¨å­—ç¬¦ä¸²å†…ç½®å‡½æ•°splitæ–¹æ³•æ¥è¿›è¡Œæˆªå–ã€‚
å…³äºŽå†…ç½®å‡½æ•°çš„ç”¨æ³•å¯ä»¥çœ‹æˆ‘çš„è¿™ç¯‡åšå®¢ï¼š[å†…ç½®å‡½æ•°](https://xbxyftx.github.io/2025/01/30/%E6%95%B0%E7%BB%84/)

```TS
Text(joke.split('ï¼Œ')[0])
  .fontSize(20)
  .fontWeight(600)
```

![5](å¼€å¿ƒä¸€ç¬‘é¡¹ç›®ç¬”è®°/5.png)

### ä¸‹æ‹‰åˆ·æ–°

ä¸‹æ‹‰åˆ·æ–°éœ€è¦ä½¿ç”¨`Refresh`ç»„ä»¶ï¼Œ`Refresh`ç»„ä»¶éœ€è¦ä¼ å…¥`refreshing`å±žæ€§ï¼Œ`refreshing`å±žæ€§ä¸º`boolean`ç±»åž‹ï¼Œå½“`refreshing`å±žæ€§ä¸º`true`æ—¶ï¼Œ`Refresh`ç»„ä»¶ä¼šæ˜¾ç¤ºåˆ·æ–°åŠ¨ç”»ã€‚
`Refresh`ç»„ä»¶å®˜æ–¹æ–‡æ¡£ï¼š[refreshç»„ä»¶](https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-container-refresh-V5)

```TS
@State refreshing: boolean = false
Refresh({ refreshing: $$this.refreshing })
```

åˆ©ç”¨åŒå‘ç»‘å®šï¼Œæˆ‘ä»¬å¯ä»¥åœ¨`Refresh`ç»„ä»¶ä¸­ä¿®æ”¹`refreshing`å±žæ€§ï¼Œä»Žè€Œå®žçŽ°ä¸‹æ‹‰åˆ·æ–°ã€‚

#### åˆ·æ–°é€»è¾‘å‡½æ•°

åœ¨ä¸‹æ‹‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªåˆ·æ–°é€»è¾‘å‡½æ•°æ¥å¤„ç†èŽ·å–æ–°ç¬‘è¯çš„è¯·æ±‚ï¼Œå¹¶åœ¨`Refresh`ç»„ä»¶ä¸­è°ƒç”¨ã€‚
åŒæ—¶ç”±äºŽåˆ·æ–°åŠ¨ç”»å¹¶ä¸ä¼šè‡ªåŠ¨åœæ­¢ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨åˆ·æ–°é€»è¾‘å‡½æ•°ä¸­æ‰‹åŠ¨åœæ­¢åˆ·æ–°åŠ¨ç”»ã€‚

ä¸‹æ‹‰åˆ·æ–°æ—¶çš„é€»è¾‘ä¸ŽèŽ·å–é»˜è®¤æ•°æ®æ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤æˆ‘ä»¬ç›´æŽ¥å°†`aboutToAppear`ç”Ÿå‘½å‘¨æœŸä¸­çš„ä»£ç å°è£…ä¸º`getJokeList`å‡½æ•°å³å¯ã€‚

```TS
  private getJokeList() {
    this.req.request(`https://api-vue-base.itheima.net/api/joke/list?num=${this.jokeNum}`)
      .then((res) => {
        this.jokes = (JSON.parse(res.result.toString()) as JokeResponse).data
      })
  }
```

å¯¹åº”çš„`aboutToAppear`ç”Ÿå‘½å‘¨æœŸä¸­çš„ä»£ç å¦‚ä¸‹ï¼š

```TS
  aboutToAppear(): void {
    this.getJokeList()
  }
```

æŒ‰ç…§ä»¥å¾€çš„é€»è¾‘æˆ‘ä»¬ç›´æŽ¥å°†åˆ·æ–°äº‹ä»¶çš„å¤„ç†å‡½æ•°å†™ä¸ºå¦‚ä¸‹å½¢å¼ï¼š

```TS
.onRefreshing(()=>{
  this.getJokeList()
  this.refreshing = false
})
```

è¿™æ ·å°±ä¼šå‡ºçŽ°ä¸€ä¸ªbugã€‚
åœ¨ä¸‹æ‹‰åˆ·æ–°äº‹ä»¶è§¦å‘åŽåˆ·æ–°åŠ¨ç”»æŒ‡æŒ¥æ˜¾ç¤ºä¸€çž¬é—´ï¼Œç„¶åŽå°±ä¼šæ¶ˆå¤±ã€‚ä½†æ­¤æ—¶ç”±äºŽç½‘ç»œè¯·æ±‚è€—æ—¶è¾ƒé•¿å¯¼è‡´ç¬‘è¯åˆ—è¡¨å¹¶æ²¡æœ‰å®žçŽ°åˆ·æ–°ï¼Œè€Œæ˜¯é—´éš”å‡ ç§’åŽæ‰ä¼šåˆ·æ–°ã€‚
è¿™æ˜¯ç”±äºŽç½‘ç»œè¯·æ±‚èŽ·å–ç»“æžœçš„thenæ–¹æ³•å±žäºŽå¼‚æ­¥æ–¹æ³•ï¼Œä¼šåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åŽè¿”å›žç»“æžœï¼Œè€Œåœæ­¢åˆ·æ–°åŠ¨ç”»çš„ä»£ç æ—¶åŒæ­¥çš„ï¼Œæ‰€ä»¥ä¼šè·³è¿‡ç­‰å¾…å¼‚æ­¥æ–¹æ³•çš„è¿”å›žç»“æžœï¼Œç›´æŽ¥æ‰§è¡Œåœæ­¢åˆ·æ–°åŠ¨ç”»çš„ä»£ç ã€‚
å› æ­¤æˆ‘ä»¬éœ€è¦å°†åœæ­¢åˆ·æ–°åŠ¨ç”»çš„ä»£ç æ”¾åœ¨å¼‚æ­¥æ–¹æ³•çš„thenæ–¹æ³•ä¸­æ‰§è¡Œã€‚

```TS
private getJokeList() {
  this.req.request(`https://api-vue-base.itheima.net/api/joke/list?num=${this.jokeNum}`)
    .then((res) => {
      this.jokes = (JSON.parse(res.result.toString()) as JokeResponse).data
      this.refreshing = false
    })
}

.onRefreshing(()=>{
  this.getJokeList()
})
```

ç»æµ‹è¯•åŠŸèƒ½æ­£å¸¸ã€‚
è¿™ç§ç¼–ç ç»†èŠ‚æ­£æ˜¯æˆ‘ä»¬åœ¨å­¦ä¹ ç¼–ç¨‹æ—¶éœ€è¦æ ¼å¤–æ³¨æ„çš„ã€‚

![6](å¼€å¿ƒä¸€ç¬‘é¡¹ç›®ç¬”è®°/6.png)

### è§¦åº•åŠ è½½æ›´å¤š

`List`ç»„ä»¶çš„å®˜æ–¹æ–‡æ¡£ï¼š[List](https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-container-list-V5)

![7](å¼€å¿ƒä¸€ç¬‘é¡¹ç›®ç¬”è®°/7.png)

è§¦åº•åŠ è½½æ›´å¤šéœ€è¦ä½¿ç”¨`List`ç»„ä»¶çš„`onReachEnd`äº‹ä»¶ï¼Œ`onReachEnd`äº‹ä»¶ä¼šåœ¨åˆ—è¡¨è¾¹ç¼˜æ•ˆæžœä¸ºå¼¹ç°§æ•ˆæžœæ—¶ï¼Œåˆ’åŠ¨ç»è¿‡æœ«å°¾ä½ç½®æ—¶è§¦å‘ä¸€æ¬¡ï¼Œå›žå¼¹å›žæœ«å°¾ä½ç½®æ—¶å†è§¦å‘ä¸€æ¬¡ã€‚

ç”±äºŽæˆ‘å¯¹äºŽè¯¥äº‹ä»¶å¹¶ä¸ç†Ÿæ‚‰æ‰€ä»¥å…ˆç”¨å¼¹çª—çš„æ–¹å¼æ¥è¿›è¡Œæµ‹è¯•ã€‚

```TS
.onReachEnd(()=>{
  AlertDialog.show({
    message:'è§¦åº•äº†'
  })
})
```

![8](å¼€å¿ƒä¸€ç¬‘é¡¹ç›®ç¬”è®°/8.png)

ç»æµ‹è¯•æˆ‘ä»¬ç†è§£äº†å®ƒçš„è§¦å‘æ¡ä»¶ï¼Œæœ¬æ¥æˆ‘åœ¨ç–‘æƒ‘å®ƒè§¦å‘ä¸¤æ¬¡çš„æ•ˆæžœæ˜¯ä»€ä¹ˆæ„æ€ï¼Œè€Œåœ¨æµ‹è¯•ä¸­å¼¹å‡ºä¸¤æ¬¡å¼¹çª—çš„æ—¶æœºè®©æˆ‘æ›´åŠ ç†è§£äº†å®ƒçš„è§¦å‘æ¡ä»¶ã€‚

#### è§¦åº•åŠ è½½æ›´å¤šé€»è¾‘å‡½æ•°

**æ³¨æ„ï¼š**è§¦åº•åŠ è½½æ›´å¤šçš„é€»è¾‘ä¸Žä¸‹æ‹‰åˆ·æ–°çš„é€»è¾‘ä¸ä¸€æ ·ï¼Œä¸èƒ½ç›´æŽ¥å¥—ç”¨ï¼Œéœ€è¦é‡æ–°å®šä¹‰ã€‚
ä¸‹æ‹‰åˆ·æ–°æ˜¯é‡æ–°èŽ·å–æ–°çš„ç¬‘è¯ï¼Œè€Œè§¦åº•åŠ è½½æ›´å¤šæ˜¯åœ¨åŽŸæœ‰ç¬‘è¯çš„åŸºç¡€ä¸ŠèŽ·å–æ–°çš„ç¬‘è¯ã€‚

```TS
  private reachEnd() {
    this.req.request(`https://api-vue-base.itheima.net/api/joke/list?num=${this.jokeNum}`)
      .then((res) => {
        this.jokes.push(...(JSON.parse(res.result.toString()) as JokeResponse).data)
      })
  }
```

ä½†æ­¤æ—¶ä¼šå‘çŽ°å®ƒç”±äºŽ`onReachEnd`äº‹ä»¶çš„è§¦å‘æœºåˆ¶å‘é€äº†ä¸¤æ¬¡è¯·æ±‚ï¼ŒèŽ·å–äº†åæ¡ç¬‘è¯ï¼Œå¹¶éžè®¾å®šå¥½çš„äº”æ¡ã€‚
è™½ç„¶è¿™ä¸ªçŽ°è±¡æ— ä¼¤å¤§é›…ï¼Œä½†ä¸ºäº†ä½¿åº”ç”¨çš„æ€§èƒ½æ›´å¥½ï¼Œå°±éœ€è¦å‡å°‘ç½‘ç»œè¯·æ±‚çš„æ¬¡æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è¿›è¡Œä¼˜åŒ–ã€‚
æˆ‘ä»¬è™½ç„¶æ²¡æœ‰åŠžæ³•æ›´æ”¹`onReachEnd`äº‹ä»¶çš„è§¦å‘æœºåˆ¶ï¼Œä½†æˆ‘ä»¬å¯ä»¥åœ¨è§¦åº•åŠ è½½æ›´å¤šé€»è¾‘å‡½æ•°ä¸­è¿›è¡Œä¼˜åŒ–ã€‚

**æ€è·¯**ï¼š

1. å®šä¹‰ä¸€ä¸ªå˜é‡`isLoading`ï¼Œç”¨äºŽåˆ¤æ–­æ˜¯å¦æ­£åœ¨åŠ è½½æ›´å¤šæ•°æ®ã€‚
2. åœ¨è§¦åº•åŠ è½½æ›´å¤šé€»è¾‘å‡½æ•°ä¸­ï¼Œåˆ¤æ–­`isLoading`æ˜¯å¦ä¸º`true`ï¼Œå¦‚æžœä¸º`true`ï¼Œåˆ™ä¸è¿›è¡ŒåŠ è½½æ›´å¤šæ•°æ®çš„æ“ä½œã€‚
3. åœ¨è§¦åº•åŠ è½½æ›´å¤šé€»è¾‘å‡½æ•°ä¸­ï¼Œå°†`isLoading`è®¾ç½®ä¸º`true`ï¼Œè¡¨ç¤ºæ­£åœ¨åŠ è½½æ›´å¤šæ•°æ®ã€‚
4. å½“å¼‚æ­¥å‡½æ•°èŽ·å–æ•°æ®æˆåŠŸåŽï¼Œå°†`isLoading`è®¾ç½®ä¸º`false`ï¼Œè¡¨ç¤ºåŠ è½½æ›´å¤šæ•°æ®å®Œæˆã€‚

è¿™æ ·å°±å¯ä»¥é¿å…å¤šæ¬¡è§¦å‘è§¦åº•åŠ è½½æ›´å¤šé€»è¾‘å‡½æ•°ã€‚
è¿™ç§æ–¹æ³•ç§°ä¹‹ä¸º`å˜é‡æŽ§åˆ¶æ³•`ã€‚

```TS
  private reachEnd() {
    // AlertDialog.show({
    //   message:'reachEnd'
    // })
    if (!this.isLoadingMore){
      this.isLoadingMore = true
      this.req.request(`https://api-vue-base.itheima.net/api/joke/list?num=${this.jokeNum}`)
        .then((res) => {
          this.jokes.push(...(JSON.parse(res.result.toString()) as JokeResponse).data)
          this.isLoadingMore = false
        })
    }
  }
```

#### è§¦åº•åŠ è½½æ›´å¤šåŠ¨ç”»

ä¸ºäº†è®©ç”¨æˆ·çŸ¥é“æˆ‘ä»¬æ­£åœ¨åŠ è½½æ›´å¤šæ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨`List`ç»„ä»¶æœ«å°¾æ·»åŠ ä¸€ä¸ªåŠ¨ç”»ï¼Œè®©ç”¨æˆ·çŸ¥é“æˆ‘ä»¬æ­£åœ¨åŠ è½½æ›´å¤šæ•°æ®ã€‚

```TS
if (this.isLoadingMore){
  ListItem(){
    LoadingProgress()
      .width(50)
  }
  .width('100%')
}
```

![9](å¼€å¿ƒä¸€ç¬‘é¡¹ç›®ç¬”è®°/9.png)

### ç‚¹å‡»è¿”å›žé¡¶éƒ¨

åˆ©ç”¨`listScroller`æŽ§åˆ¶å™¨æ¥å®žçŽ°è¿”å›žåˆ°`List`ç»„ä»¶é¡¶éƒ¨çš„åŠŸèƒ½ã€‚

```TS
Image($r('app.media.ic_public_joke_logo'))
  .width(30)
  .onClick(()=>{
    // this.listScroller.scrollEdge(Edge.Top)
    this.listScroller.scrollTo({
      xOffset:0,
      yOffset:0,
      animation:true
    })
  })
```

è¿™æ ·è™½ç„¶å¯ä»¥å®žçŽ°å›žåˆ°é¡¶éƒ¨ï¼Œä½†æ²¡æœ‰åŠ¨ç”»æ•ˆæžœï¼Œæ˜¯ç›´æŽ¥é—ªçŽ°å›žåŽ»ã€‚
å¯¹äºŽæ•´ä½“åº”ç”¨çš„æµç•…æ€§æ¥è¯´ï¼Œè¿™æ˜¯ä¸å¤Ÿçš„ã€‚

## å‡çº§è‡³çŠ¶æ€ç®¡ç†V2ç‰ˆæœ¬

æœ¬é¡¹ç›®å‡çº§è¾ƒä¸ºç®€å•ï¼Œåªéœ€è¦å°†`@State`æ”¹ä¸º`@Local`å³å¯ã€‚

```TS
import { http } from '@kit.NetworkKit'

/**
 * 1. é»˜è®¤åŠ è½½
 * 2. ä¸‹æ‹‰åˆ·æ–°
 * 3. è§¦åº•åŠ è½½æ›´å¤š
 * 4. ç‚¹å‡»è¿”å›žé¡¶éƒ¨
 * */

interface JokeResponse {
  msg: string
  code: number
  data: string[]
}

@Entry
@ComponentV2
struct Day01_07_Jokes {
  req = http.createHttp()
  @Local jokes: string [] = []
  jokeNum: number = 5
  @Local refreshing: boolean = false
  listScroller: Scroller = new Scroller()
  @Local isLoadingMore:boolean = false

  aboutToAppear(): void {
    this.getJokeList()
  }
  private getJokeList() {
    this.req.request(`https://api-vue-base.itheima.net/api/joke/list?num=${this.jokeNum}`)
      .then((res) => {
        this.jokes = (JSON.parse(res.result.toString()) as JokeResponse).data
        this.refreshing = false
      })
  }
  private reachEnd() {
    // AlertDialog.show({
    //   message:'reachEnd'
    // })
    if (!this.isLoadingMore){
      this.isLoadingMore = true
      this.req.request(`https://api-vue-base.itheima.net/api/joke/list?num=${this.jokeNum}`)
        .then((res) => {
          this.jokes.push(...(JSON.parse(res.result.toString()) as JokeResponse).data)
          this.isLoadingMore = false
        })
    }
  }

  build() {
    Refresh({ refreshing: $$this.refreshing }) {
      Column() {
        // é¡¶éƒ¨
        this.HeaderBuilder()
        // ç¬‘è¯åˆ—è¡¨
        List({ space: 10, scroller: this.listScroller }) {
          ForEach(this.jokes, (joke: string) => {
            ListItem() {
              Column({ space: 10 }) {
                Text(joke.split('ï¼Œ')[0])
                  .fontSize(20)
                  .fontWeight(600)
                Row({ space: 15 }) {
                  titleIcon({ icon: $r('app.media.ic_public_time'), info: '2024-1-1' })
                  titleIcon({ icon: $r('app.media.ic_public_read'), info: 'é˜…è¯»(6666)' })
                  titleIcon({ icon: $r('app.media.ic_public_comments'), info: 'è¯„è®º(123)' })
                }

                Text(joke)
                  .fontSize(15)
                  .fontColor(Color.Gray)
              }
              .width('100%')
              .alignItems(HorizontalAlign.Start)
              .padding(20)

            }
            .borderRadius(10)
            .backgroundColor(Color.White)
            .shadow({ radius: 2, color: Color.Gray })
          })

          if (this.isLoadingMore){
            ListItem(){
              LoadingProgress()
                .width(50)
            }
            .width('100%')
          }


        }
        .padding(10)
        .layoutWeight(1)
        .onReachEnd(() => {
          this.reachEnd()
        })

      }
      .width('100%')
      .height('100%')
      .backgroundColor('#f6f6f6')
    }
    .onRefreshing(() => {
      this.getJokeList()
    })
  }



  @Builder
  HeaderBuilder() {
    Row() {
      Image($r('app.media.ic_public_drawer_filled'))
        .width(25);

      Image($r('app.media.ic_public_joke_logo'))
        .width(30)
        .onClick(()=>{
          // this.listScroller.scrollEdge(Edge.Top)
          this.listScroller.scrollTo({
            xOffset:0,
            yOffset:0,
            animation:true
          })
        })

      Image($r('app.media.ic_public_search'))
        .width(30);
    }
    .width('100%')
    .justifyContent(FlexAlign.SpaceBetween)
    .height(60)
    .padding(10)
    .border({ width: { bottom: 2 }, color: '#f0f0f0' })
    .backgroundColor(Color.White)
  }
}

@Component
struct titleIcon {
  icon: ResourceStr = ''
  info: string = ''

  build() {
    Row() {
      Image(this.icon)
        .width(15)
        .fillColor(Color.Gray)
      Text(this.info)
        .fontSize(14)
        .fontColor(Color.Gray)
    }
  }
}
```
