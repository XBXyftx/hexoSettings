---
title: é¸¿è’™è®°è´¦æœ¬é¡¹ç›®ç¬”è®°
date: 2025-01-25 21:06:51
tags: 
  - é¸¿è’™
  - æŠ€æœ¯å‘
  - é¡¹ç›®
cover: /img/ArticleTopImgs/JiZhangBenTopImg.png
description: æ•°æ®å…±äº«ç»ƒä¹ 
typewriter: ğŸ’° æ‰“é€ ä¸ªäººè´¢åŠ¡ç®¡ç†åŠ©æ‰‹ï¼æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†é¸¿è’™è®°è´¦æœ¬é¡¹ç›®çš„å¼€å‘å…¨è¿‡ç¨‹ã€‚é¡¹ç›®é‡‡ç”¨æ¸…æ–°å¯çˆ±çš„UIè®¾è®¡ï¼Œæ”¯æŒåˆ†ç±»å‹çš„æ”¶æ”¯è®°å½•ç®¡ç†ã€‚é€šè¿‡å®é™…å¼€å‘æ¡ˆä¾‹æ¼”ç¤ºäº†é¸¿è’™åº”ç”¨çš„æ•°æ®å…±äº«æœºåˆ¶ã€ç»„ä»¶åŒ–å¼€å‘æ€è·¯ã€ä»¥åŠç”¨æˆ·ç•Œé¢çš„äº¤äº’è®¾è®¡ã€‚æ¶µç›–äº†é¡¹ç›®æ¶æ„è®¾è®¡ã€æ•°æ®æ¨¡å‹å®šä¹‰ã€ç•Œé¢å¸ƒå±€å®ç°ã€çŠ¶æ€ç®¡ç†ç­‰æ ¸å¿ƒå¼€å‘æŠ€æœ¯ã€‚é¡¹ç›®ä¸ä»…å®ç°äº†åŸºç¡€çš„è®°è´¦åŠŸèƒ½ï¼Œæ›´æ˜¯é¸¿è’™å¼€å‘æŠ€æœ¯çš„ç»¼åˆå®è·µï¼Œé€‚åˆå­¦ä¹ é¸¿è’™åº”ç”¨å¼€å‘çš„å®Œæ•´æµç¨‹ã€‚
post_copyright:
copyright_author: XBXyftx
copyright_author_href: https://github.com/XBXyftx
copyright_url: https://xbxyftx.top
copyright_info: æ­¤æ–‡ç« ç‰ˆæƒå½’XBXyftxæ‰€æœ‰ï¼Œå¦‚æœ‰è½¬è½½ï¼Œè¯·è¨»æ˜æ¥è‡ªåŸä½œè€…
---

## è®°è´¦æœ¬é¡¹ç›®ç®€ä»‹

**é¡¹ç›®åç§°**ï¼šBH\_NoteBook(è®°è´¦æœ¬)

**é¡¹ç›®ä½œè€…**ï¼šè–›åšç’‡

**é¡¹ç›®å¼€æºåœ°å€**ï¼šhttps://github.com/XBXyftx/BH\_NoteBook

**é¡¹ç›®ç®€ä»‹**ï¼šä¸€æ¬¾ç•Œé¢æ¸…æ–°å¯çˆ±çš„è®°è´¦æœ¬è½¯ä»¶ï¼Œæ”¯æŒåˆ†äº‹ä»¶ç±»å‹çš„æ”¯å‡ºæ”¶å…¥è®°è´¦ã€‚

## å¼€å‘ç¬”è®°

### åŸºæœ¬ç»“æ„ï¼š

æ•´ä½“åˆ†ä¸ºä¸¤ä¸ªé¡µé¢ï¼Œé¦–é¡µå’Œè®°è´¦é¡µã€‚

å·¥ç¨‹ç»“æ„åœ¨åŸæœ‰stagestageæ¨¡å‹ä¸Šæ–°å¢componentså’Œdataæ–‡ä»¶å¤¹ã€‚

![1](é¸¿è’™è®°è´¦æœ¬é¡¹ç›®ç¬”è®°/1.PNG)

#### components

è¯¥æ–‡ä»¶å¤¹å­˜å‚¨çš„æ˜¯å„ä¸ªæ ¸å¿ƒé¡µé¢ç»„ä»¶ï¼Œåˆ©äºè¿›è¡Œæ•°æ®è§£è€¦ã€‚

#### data

è¯¥æ–‡ä»¶å¤¹ä¸­å­˜å‚¨çš„æ˜¯å·¥å…·æ¥å£å’Œæ•°æ®ã€‚åœ¨BillDataæ–‡ä»¶ä¸­å®šä¹‰äº†æ¯ä¸ªè´¦å•äº‹ä»¶çš„å·¥å…·æ¥å£BillItemï¼Œå…¶ä¸­åŒ…æ‹¬äº†å››ä¸ªå±æ€§ã€‚

```
// è®¢å•
export interface BillItem {
  id: number
  type: BillType
  money: number
  useFor: UseForItem
}

// è´¦å•é¡¹
export interface UseForItem {
  id: number
  icon: ResourceStr
  name: string
}

// æ”¯ä»˜ç±»å‹ æšä¸¾
export enum BillType {
  Pay,
  InCome
}
```

è¿™å››ä¸ªå±æ€§åˆ†åˆ«ä»£è¡¨äº†è´¦å•çš„idï¼Œæ”¶å…¥æˆ–æ˜¯æ”¯å‡ºï¼Œé‡‘é¢æ•°é‡ä»¥åŠå…·ä½“çš„è´¦å•ç±»å‹ã€‚

é’ˆå¯¹äºè´¦å•ç±»å‹ï¼ŒBillDataæ–‡ä»¶åˆ©ç”¨constå®šä¹‰äº†ä¸¤ä¸ªä¸ªå¸¸é‡å¯¹è±¡æ•°ç»„ï¼Œç”¨äºå®šä¹‰ä¸€äº›å¸¸è§çš„æ”¯å‡ºæ”¶å…¥ç±»å‹ï¼Œä¾›ç”¨æˆ·é€‰æ‹©ã€‚

```
// æ”¯å‡ºçš„ç±»å‹åˆ†ç±»
export const payBillCategoryList: UseForCategory[] = [
  {
    title: 'é¤é¥®',
    items: [
      {
        id: 1, icon: $r('app.media.food'), name: 'é¤è´¹'
      },
      {
        id: 2, icon: $r('app.media.drinks'), name: 'é…’æ°´é¥®æ–™'
      },
      {
        id: 3, icon: $r('app.media.dessert'), name: 'ç”œå“é›¶é£Ÿ'
      },
    ]
  },
  {
    title: 'å‡ºè¡Œäº¤é€š',
    items: [
      {
        id: 4, icon: $r('app.media.taxi'), name: 'æ‰“è½¦ç§Ÿè½¦'
      },
      {
        id: 5, icon: $r('app.media.longdistance'), name: 'æ—…è¡Œç¥¨è´¹'
      },
    ]
  },
  {
    title: 'ä¼‘é—²å¨±ä¹',
    items: [
      {
        id: 6, icon: $r('app.media.bodybuilding'), name: 'è¿åŠ¨å¥èº«'
      },
      {
        id: 7, icon: $r('app.media.game'), name: 'ä¼‘é—²ç©ä¹'
      },
      {
        id: 8, icon: $r('app.media.audio'), name: 'åª’ä½“å½±éŸ³'
      },
      {
        id: 9, icon: $r('app.media.travel'), name: 'æ—…æ¸¸åº¦å‡'
      },
    ],
  },
  {
    title: 'æ—¥å¸¸æ”¯å‡º',
    items: [
      {
        id: 10, icon: $r('app.media.clothes'), name: 'è¡£æœè£¤å­'
      },
      {
        id: 11, icon: $r('app.media.bag'), name: 'é‹å¸½åŒ…åŒ…'
      },
      {
        id: 12, icon: $r('app.media.book'), name: 'çŸ¥è¯†å­¦ä¹ '
      },
      {
        id: 13, icon: $r('app.media.promote'), name: 'èƒ½åŠ›æå‡'
      },
      {
        id: 14, icon: $r('app.media.home'), name: 'å®¶è£…å¸ƒç½®'
      },
    ],
  },
  {
    title: 'å…¶ä»–æ”¯å‡º',
    items: [{ id: 15, icon: $r('app.media.community'), name: 'ç¤¾åŒºç¼´è´¹' }]
  }
]

// æ”¶å…¥çš„ç±»å‹åˆ†ç±»
export const inComBillCategoryList: UseForCategory[] = [
  {
    title: 'ä¸ªäººæ”¶å…¥',
    items: [
      { id: 16, icon: $r('app.media.salary'), name: 'å·¥èµ„' },
      { id: 17, icon: $r('app.media.overtimepay'), name: 'åŠ ç­' },
      { id: 18, icon: $r('app.media.bonus'), name: 'å¥–é‡‘' },
    ],
  },
  {
    title: 'å…¶ä»–æ”¶å…¥',
    items: [
      { id: 19, icon: $r('app.media.financial'), name: 'ç†è´¢æ”¶å…¥' },
      { id: 20, icon: $r('app.media.cashgift'), name: 'ç¤¼é‡‘æ”¶å…¥' },
    ],
  },
]
```

#### æ”¯å‡ºæ”¶å…¥é«˜äº®åˆ‡æ¢

```
@State billType:BillType = BillType.Pay
```

è®¾ç½®æ ‡å¿—æ€§çŠ¶æ€å˜é‡ï¼Œé…åˆä¸‰å…ƒè¿ç®—ç¬¦å®ç°

![1](é¸¿è’™è®°è´¦æœ¬é¡¹ç›®ç¬”è®°/2.png)

#### åˆ‡æ¢è´¦å•ç±»å‹æ¸²æŸ“

åœ¨æ·»åŠ æ–°è´¦å•æ—¶ä¼šé€‰æ‹©è´¦å•æ‰€å±çš„æ”¯å‡ºæˆ–æ”¶å…¥ç±»å‹ï¼Œè€Œæ¯ç±»è´¦å•ç±»å‹åˆæœ‰è®¸å¤šå­ç±»ï¼Œæ‰€ä»¥åœ¨æ¸²æŸ“ç±»å‹åˆ—è¡¨æ—¶é‡‡ç”¨åŒé‡ForEachæ¥è¿›è¡Œæ¸²æŸ“ï¼Œè€Œæ¯ä¸ªå¤§ç±»çš„å­ç±»æ•°é‡ä¸ä¸€ï¼Œæ‰€ä»¥é‡‡ç”¨flexç»„ä»¶æ¥å®ç°å¼¹æ€§å¸ƒå±€ï¼Œè‡ªåŠ¨æ¢è¡Œã€‚

æ¯ä¸ªç±»å‹çš„æ˜¾ç¤ºéƒ½æ˜¯ç”±ä¸€ä¸ªå›¾ç‰‡å’Œä¸€ä¸ªå­—ç¬¦ä¸²ç»„æˆï¼Œæ‰€ä»¥å°†å…¶å°è£…ä¸ºè‡ªå®šä¹‰ç»„ä»¶IconComï¼Œé€šè¿‡å°†å¸¦æ¸²æŸ“å¯¹è±¡ä¼ å…¥æ¥è¿›è¡Œæ¸²æŸ“ã€‚åŒæ—¶æ ¹æ®selectedIDæ ‡è¯†ç¬¦æ¥åˆ‡æ¢é€‰ä¸­çŠ¶æ€ã€‚

```
// è®¢å•
List({ space: 10 }) {
  ForEach(this.billType === BillType.Pay ? payBillCategoryList : inComBillCategoryList,
    (item: UseForCategory, index: number) => {
      ListItem() {
        Column({ space: 20 }) {
          Text(item.title)
            .alignSelf(ItemAlign.Start)
            .fontColor(Color.Gray)
            .fontSize(14)

          Flex({ wrap: FlexWrap.Wrap, direction: FlexDirection.Row,space:{main:LengthMetrics.vp(30),cross:LengthMetrics.vp(20)} }) {
            ForEach(item.items, (useForItem: UseForItem) => {
              if (this.selectedID === useForItem.id) {
                IconCom({ useForItem: useForItem })
                  .borderRadius(5)// é€‰ä¸­çš„é«˜äº®æ ·å¼
                  .border({ width: 1, color: '#5b8161' })
                  .backgroundColor('#dcf1e4')
                  .onClick(()=>{
                    this.selectedID=useForItem.id
                  })
              } else {
                IconCom({ useForItem: useForItem })
                  .borderRadius(5)// é»˜è®¤çš„æ ·å¼
                  .border({ width: 1, color: Color.Transparent })
                  .backgroundColor(Color.Transparent)
                  .onClick(()=>{
                    this.selectedID=useForItem.id
                  })
              }
            })
          }
          .alignSelf(ItemAlign.Start)

        }
        .width('100%')
      }
    })

}
.padding(15)
.width('100%')
.borderRadius(25)
.height(500)
.backgroundColor(Color.White)
```

![1](é¸¿è’™è®°è´¦æœ¬é¡¹ç›®ç¬”è®°/3.png)

#### æŒä¹…åŒ–

```
PersistentStorage.persistProp<BillItem[]>('list',[])
```

#### æ·»åŠ è´¦å•

åœ¨æ·»åŠ æŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œåˆ¤æ–­é‡‘é¢æ˜¯å¦ä¸º0é˜²æ­¢é”™è´¦å‡ºç°ã€‚è‹¥é‡‘é¢æ­£å¸¸åˆ™è·å–AppStorageä¸­çš„å¸å•åˆ—è¡¨ç´¢å¼•ï¼Œåˆ©ç”¨unshiftå†…ç½®å‡½æ•°æ¥å°†æ–°è´¦å•æ’å…¥åˆ°æ•°ç»„è¡¨å¤´ã€‚

```
export function addItem(item:BillItem){
  if (item.money=== 0) {
    AlertDialog.show({
      message:'é‡‘é¢ä¸èƒ½ä¸ºç©º'
    })
    return
  }else {
    const list = AppStorage.link<BillItem[]>('list')
    list.get().unshift(item)
  }
}
```

è€Œç”±äºåœ¨é¡µé¢çš„çŠ¶æ€å˜é‡inputNumå¤„åªè·å–åˆ°äº†å¯¹åº”Itemçš„idç´¢å¼•æ‰€ä»¥è¿˜éœ€è¦ä¸€ä¸ªå‡½æ•°æ¥å¤„ç†ç´¢å¼•åˆ°Itemå¯¹è±¡çš„è½¬æ¢ã€‚

```
export function getSelectedItemById(index:number){
  // éå†æ”¯å‡ºåˆ†ç±»
  for (const category of payBillCategoryList) {
    const item = category.items.find((item) => item.id === index);
    if (item) return item;
  }

  // éå†æ”¶å…¥åˆ†ç±»
  for (const category of inComBillCategoryList) {
    const item = category.items.find((item) => item.id === index);
    if (item) return item;
  }
  return null
}

Button('ä¿ å­˜')
  .width('80%')
  .type(ButtonType.Capsule)
  .backgroundColor(Color.Transparent)
  .fontColor('#5b8161')
  .border({ width: 1, color: '#5b8161' })
  .margin(10)
  .onClick(()=>{
    addItem({
      id:Number(new Date().toUTCString()+Math.floor(Math.random()*100)),
      type:this.billType,
      money:this.inputNum,
      useFor:getSelectedItemById(this.selectedID)!
    })
  })
```

getSelectedItemByIdå‡½æ•°çš„è¿”å›å€¼æ˜¯UseForItem|nullçš„è”åˆç±»å‹ï¼Œæ‰€ä»¥æ­¤å¤„è¦ä½¿ç”¨ï¼è¿›è¡Œéç©ºæ–­è¨€ã€‚

**åœ¨åç»­å¼€å‘ä¸­æˆ‘æ„è¯†åˆ°è´¦å•é‡‘é¢å­˜åœ¨æ­£è´Ÿæ•°é—®é¢˜ï¼Œç”¨æˆ·å¾ˆå¯èƒ½ä¸ä¼šæ­£ç¡®çš„æŒ‰ç…§æ­£è´Ÿæ•°æ¥è¿›è¡Œè¾“å…¥ï¼Œä¸ºé˜²æ­¢å­˜å…¥çš„æ•°æ®å‘ç”Ÿé”™è¯¯å¯¼è‡´æ•°æ®å¤±çœŸï¼Œè¿™é‡Œé’ˆå¯¹äºç‚¹å‡»äº‹ä»¶è¿›è¡Œä¿®æ”¹ã€‚æ— è§†ç”¨æˆ·æ‰€è¾“å…¥çš„æ­£è´Ÿå·ï¼Œç›´æ¥æ ¹æ®å½“å‰è´¦å•ç±»å‹billTypeæ¥å¯¹ç”¨æˆ·è¾“å…¥æ•°å­—çš„ç»å¯¹å€¼æ·»åŠ æ­£è´Ÿå·ã€‚**

```
.onClick(()=>{
  if (this.billType===BillType.Pay) {
    addItem({
      id:Number(new Date().toUTCString()+Math.floor(Math.random()*100)),
      type:this.billType,
      money:-Math.abs(Number(this.inputNum)),
      useFor:getSelectedItemById(this.selectedID)!
    })
  }else if (this.billType===BillType.InCome){
    addItem({
      id:Number(new Date().toUTCString()+Math.floor(Math.random()*100)),
      type:this.billType,
      money:Math.abs(Number(this.inputNum)),
      useFor:getSelectedItemById(this.selectedID)!
    })
  }

  this.clean
})
```

#### é‡‘é¢åˆ¤å®šbug

è€Œåœ¨å®é™…æµ‹è¯•æ—¶å‘ç°è™½ç„¶inputNumçš„ç±»å‹è®¾ç½®æˆnumberæ—¶å¯ä»¥é¡ºåˆ©çš„å®ç°ä¸TextInputç»„ä»¶çš„åŒå‘ç»‘å®šï¼Œä½†åœ¨è¾“å…¥æ¡†è¾“å…¥å†…å®¹åˆåˆ é™¤åï¼ŒaddItemå‡½æ•°æ— æ³•æ­£ç¡®åˆ¤æ–­é’±çš„æ•°å€¼æ˜¯å¦ä¸º0ï¼Œæ‰€ä»¥åˆå°†inputNumçš„ç±»å‹æ”¹å›äº†stringã€‚å¯¹åº”çš„ç‚¹å‡»äº‹ä»¶ä¹Ÿè¿›è¡Œäº†å¾®è°ƒã€‚

åŒæ—¶æ›´æ”¹äº†äº‹ä»¶idçš„å‘½åæ ¼å¼ã€‚

```
.onClick(()=>{
  if (this.billType===BillType.Pay) {
    addItem({
      id:Number(new Date().getTime()+Math.floor(Math.random()*100)),
      type:this.billType,
      money:-Math.abs(Number(this.inputNum)),
      useFor:getSelectedItemById(this.selectedID)!
    })
  }else if (this.billType===BillType.InCome){
    addItem({
      id:Number(new Date().getTime()+Math.floor(Math.random()*100)),
      type:this.billType,
      money:Math.abs(Number(this.inputNum)),
      useFor:getSelectedItemById(this.selectedID)!
    })
  }

  this.clean
})
```

#### é‡‘é¢ç»Ÿè®¡

åœ¨é¦–é¡µæœ€ä¸Šæ–¹ä¼šç»Ÿè®¡å…¨éƒ¨çš„è´¦å•ä¿¡æ¯å¹¶ç»™å‡ºæ”¯å‡ºå’Œæ”¶å…¥çš„é‡‘é¢æ•°å­—ã€‚æ‰€ä»¥è¿™é‡Œå®šä¹‰ä¸‰ä¸ªå‡½æ•°æ¥è·å–æ”¶å…¥æ”¯å‡ºä»¥åŠä½™é¢ã€‚

```
export function getPaySumNum():number{
  const list = AppStorage.link<BillItem[]>('list')
  const payItemList = list.get().filter((billItem:BillItem)=>{
    return billItem.type===BillType.Pay
  })
  const paySum = payItemList.reduce((a,b)=>{
    return a + b.money
  },0)
  return paySum
}

export function getIncomeSumNum():number{
  const list = AppStorage.link<BillItem[]>('list')
  const IncomeItemList = list.get().filter((billItem:BillItem)=>{
    return billItem.type===BillType.InCome
  })
  const IncomeSum = IncomeItemList.reduce((a,b)=>{
    return a + b.money
  },0)
  return IncomeSum
}

export function getBillSumMoney():number{
  return getPaySumNum()+getIncomeSumNum()
}
```

![1](é¸¿è’™è®°è´¦æœ¬é¡¹ç›®ç¬”è®°/4.png)

#### åˆ é™¤è®¢å•

åˆ©ç”¨ListItemç»„ä»¶çš„swipeActionå±æ€§æ¥å®ç°æ»‘åŠ¨è´¦å•ç»„ä»¶æ‹‰å‡ºåˆ é™¤æŒ‰é’®æ¥è¿›è¡Œè´¦å•çš„åˆ é™¤æ“ä½œã€‚

![1](é¸¿è’™è®°è´¦æœ¬é¡¹ç›®ç¬”è®°/5.png)

å®šä¹‰å‡½æ•°deleteItemç”¨äºå¤„ç†åˆ é™¤äº‹ä»¶ï¼Œç›´æ¥é€šè¿‡idè¿›è¡Œç­›é€‰åˆ é™¤å³å¯ã€‚

```TypeScript
export function deleteItem(id: number) {
  const list = AppStorage.link<BillItem[]>('list')
  list.set(list.get().filter(item => item.id != id))
}
```
