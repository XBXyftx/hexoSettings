#loading-box
    .sparks-combo
        .spark
        .spark
        .spark
        .spark
    .rainbow
        span
    .nyan-cat
        .feet
        .tail
            span
        .body
        .head
    script(src="/js/nyan.js")

script.
    const preloader = {
        endLoading: () => {
            document.body.style.overflow = 'auto';
            document.getElementById('loading-box').classList.add("loaded")
        },
        initLoading: () => {
            document.body.style.overflow = '';
            document.getElementById('loading-box').classList.remove("loaded")
        }
    }

    if (!{theme.pjax && theme.pjax.enable}) {
        document.addEventListener('pjax:send', () => { preloader.initLoading() })
        document.addEventListener('pjax:complete', () => { preloader.endLoading() })
    }
script.
  (()=>{
    const $loadingBox = document.getElementById('loading-box')
    const $body = document.body
    const preloader = {
      endLoading: () => {
        $body.style.overflow = ''
        $loadingBox.classList.add('loaded')
        setTimeout(() => {
          $loadingBox.style.display = 'none'
        }, 800)
      },
      initLoading: () => {
        $loadingBox.style.display = 'flex'
        $loadingBox.classList.remove('loaded')
        $body.style.overflow = 'hidden'
      }
    }

    preloader.initLoading()
    
    // 设置20秒超时
    const loadingTimeout = setTimeout(() => {
      preloader.endLoading()
    }, 20000)
    
    window.addEventListener('load', () => {
      clearTimeout(loadingTimeout)
      preloader.endLoading()
    })

    if (!{theme.pjax && theme.pjax.enable}) {
      btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
      btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
    }
  })()